@page "/Account/Manage/Email"
@layout ManageLayout

@using System.ComponentModel.DataAnnotations
@using System.Text
@using System.Text.Encodings.Web
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.WebUtilities
@using LMS.Blazor.Data

@inject UserManager<ApplicationUser> UserManager
@inject IEmailSender<ApplicationUser> EmailSender
@inject IdentityUserAccessor UserAccessor
@inject NavigationManager NavigationManager

<PageTitle>Ändra e-post</PageTitle>

<div class="dash-card__head">Ändra e-postadress</div>

<StatusMessage Message="@message" />

<form @onsubmit="OnSendEmailVerificationAsync" @formname="send-verification" id="send-verification-form" method="post">
    <AntiforgeryToken />
</form>

<EditForm Model="Input" FormName="change-email" OnValidSubmit="OnValidSubmitAsync" method="post">
    <DataAnnotationsValidator />
    <ValidationSummary class="text-danger mb-3" role="alert" />

    <div class="row g-3">
        <div class="col-12">
            <label for="current-email" class="form-label text-muted small">Nuvarande e-post</label>
            <div class="input-group">
                <input type="text" value="@email" class="form-control" disabled />
                @if (isEmailConfirmed)
                {
                    <span class="input-group-text text-success">
                        <i class="bi bi-check-circle-fill"></i>
                    </span>
                }
                else
                {
                    <button type="submit" class="btn btn-outline-secondary" form="send-verification-form">
                        <i class="bi bi-envelope me-1"></i>Skicka verifiering
                    </button>
                }
            </div>
            @if (!isEmailConfirmed)
            {
                <small class="text-warning">
                    <i class="bi bi-exclamation-triangle me-1"></i>E-posten är inte verifierad
                </small>
            }
        </div>

        <div class="col-12">
            <label for="new-email" class="form-label text-muted small">Ny e-postadress</label>
            <InputText @bind-Value="Input.NewEmail" class="form-control" autocomplete="email"
                       aria-required="true" placeholder="Ange din nya e-postadress" />
            <ValidationMessage For="() => Input.NewEmail" class="text-danger small" />
        </div>
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-change-email">
            <i class="bi bi-envelope-check me-2"></i>Ändra e-postadress
        </button>

    </div>
</EditForm>


